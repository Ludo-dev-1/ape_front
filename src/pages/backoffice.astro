---
import Layout from "../layouts/Layout.astro";
import Header from "../layouts/Header.astro";
import Footer from "../layouts/Footer.astro";

// Appel serveur
const response = await fetch("http://localhost:5000/admin/backoffice");
const data = await response.json();
const parents: Parents[] = data;

interface Parents {
    nom: string;

    email: string;

    roles: { nom: string }[];
}
---

<!-- Backoffice Page -->
<Layout>
    <Header />
    <section class="bg-gray-100 py-12">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold mb-6">
                Backoffice - Gestion des parents
            </h1>
            <p class="text-gray-700 mb-4">
                Voici la liste des parents d'élèves inscrits dans le système.
            </p>

            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th class="py-2 px-4 border-b">Nom</th>
                            <th class="py-2 px-4 border-b">Email</th>
                            <th class="py-2 px-4 border-b">Rôle</th>
                        </tr>
                    </thead>
                    <tbody>
                        {
                            Array.isArray(parents) &&
                                parents.map((parent: Parents) => (
                                    <tr>
                                        <td class="py-2 px-4 border-b">
                                            {parent.nom}
                                        </td>
                                        <td class="py-2 px-4 border-b">
                                            {parent.email}
                                        </td>
                                        <td class="py-2 px-4 border-b">
                                            {parent.roles
                                                .map((role) => role.nom)
                                                .join(", ")}
                                        </td>
                                    </tr>
                                ))
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</Layout>
<Footer />
